<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•˜ë™ì—¬ê³  ê¸‰ì‹ ì‹ë‹¨</title>
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <style>
        :root {
            --primary-color: #2ecc71; /* Lunch Green */
            --secondary-color: #e67e22; /* Dinner Orange */
            --bg-color: #f8f9fa; /* ê¹”ë”í•œ ì—°íšŒìƒ‰ ë‹¨ìƒ‰ ë°°ê²½ */
            --card-bg: #ffffff;
            --text-dark: #2c3e50;
        }

        * { box-sizing: border-box; font-family: "Pretendard", sans-serif; }

        body {
            margin: 0; padding: 20px;
            min-height: 100vh;
            background-color: var(--bg-color); /* ë‹¨ìƒ‰ ë°°ê²½ ì ìš© */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* ê¸°ì¡´ ë°°ê²½ ì˜¤ë²„ë ˆì´ ì œê±° */

        .header {
            text-align: center; margin-bottom: 20px;
            color: var(--text-dark); /* ê¸€ììƒ‰ ì–´ë‘ìš´ ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        }
        .header h1 { margin: 0; font-size: 2.5em; font-weight: 800; }

        /* Date Controls */
        .date-controls {
            display: flex; justify-content: center; align-items: center; gap: 20px;
            background: var(--card-bg); padding: 10px 30px;
            border-radius: 50px; margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* ê·¸ë¦¼ì ì•½í•˜ê²Œ */
            border: 1px solid #eee;
        }
        .btn-nav {
            background: none; border: none; font-size: 1.5em; cursor: pointer;
            color: var(--text-dark); transition: color 0.2s;
        }
        .btn-nav:hover { color: var(--primary-color); }
        #date-display { font-weight: bold; font-size: 1.2em; }
        #date-picker { position: absolute; opacity: 0; width: 0; height: 0; }
        .date-trigger { cursor: pointer; border-bottom: 2px solid #ddd; }

        /* One-Line Summary Badge */
        .summary-banner {
            background-color: #ebf0ff; /* ì—°í•œ íŒŒë€ìƒ‰ ë‹¨ìƒ‰ */
            color: #445588;
            padding: 12px 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-weight: 600;
            text-align: center;
            max-width: 600px;
            width: 100%;
            display: none;
            border: 1px solid #d0d7f0;
        }

        /* Grid Layout for Side-by-Side */
        .meal-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        .meal-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #eee;
            display: flex; flex-direction: column;
        }

        .card-header {
            font-size: 1.5em; font-weight: 800; text-align: center;
            margin-bottom: 20px; padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .lunch .card-header { color: var(--primary-color); border-color: var(--primary-color); }
        .dinner .card-header { color: var(--secondary-color); border-color: var(--secondary-color); }

        .menu-text {
            font-size: 1.1em; line-height: 1.8; color: var(--text-dark);
            white-space: pre-wrap; flex-grow: 1; text-align: center;
        }
        
        .nutrition {
            font-size: 0.85em; color: #666; background: rgba(0,0,0,0.05);
            padding: 10px; border-radius: 10px; margin-top: 20px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .meal-grid { grid-template-columns: 1fr; } /* Stack on mobile */
            .header h1 { font-size: 1.8em; }
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ« í•˜ë™ì—¬ê³  ê¸‰ì‹</h1>
    </div>

    <div class="date-controls">
        <button class="btn-nav" onclick="changeDate(-1)">&#10094;</button>
        <span id="date-display" class="date-trigger" onclick="document.getElementById('date-picker').showPicker()"></span>
        <input type="date" id="date-picker" onchange="onDatePickerChange()">
        <button class="btn-nav" onclick="changeDate(1)">&#10095;</button>
    </div>

    <!-- 1ë‹¨ê³„: ë£° ê¸°ë°˜ ìš”ì•½ ë°°ë„ˆ -->
    <div id="summary-banner" class="summary-banner">
        ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ë¶„ì„ ì¤‘...
    </div>

    <div class="meal-grid">
        <!-- Lunch Card -->
        <div class="meal-card lunch">
            <div class="card-header">â˜€ï¸ ì ì‹¬ (ì¤‘ì‹)</div>
            <div id="lunch-content" class="menu-text">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <div id="lunch-nutrition" class="nutrition"></div>
        </div>

        <!-- Dinner Card -->
        <div class="meal-card dinner">
            <div class="card-header">ğŸŒ™ ì €ë… (ì„ì‹)</div>
            <div id="dinner-content" class="menu-text">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <div id="dinner-nutrition" class="nutrition"></div>
        </div>
    </div>

    <script>
        const API_KEY = '7e9e7a950e6544da971fe8f43f6b9aa1';
        const ATPT_OFCDC_SC_CODE = 'S10';
        const SD_SCHUL_CODE = '9010120';
        let currentDate = new Date();

        window.onload = () => { updateDateUI(); fetchSchoolFood(); };

        function updateDateUI() {
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            document.getElementById('date-display').innerText =
                `${currentDate.getMonth() + 1}ì›” ${currentDate.getDate()}ì¼ (${days[currentDate.getDay()]})`;
            document.getElementById('date-picker').value = currentDate.toISOString().split('T')[0];
        }

        function changeDate(offset) {
            currentDate.setDate(currentDate.getDate() + offset);
            updateDateUI();
            fetchSchoolFood();
        }
        function onDatePickerChange() {
            const picker = document.getElementById('date-picker');
            if(picker.value) { currentDate = new Date(picker.value); updateDateUI(); fetchSchoolFood(); }
        }

        async function fetchSchoolFood() {
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            const apiDate = `${year}${month}${day}`;
            
            // Reset UI
            document.getElementById('lunch-content').innerText = 'ì •ë³´ ì—†ìŒ';
            document.getElementById('dinner-content').innerText = 'ì •ë³´ ì—†ìŒ';
            document.getElementById('summary-banner').style.display = 'none';

            try {
                const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?KEY=${API_KEY}&Type=json&ATPT_OFCDC_SC_CODE=${ATPT_OFCDC_SC_CODE}&SD_SCHUL_CODE=${SD_SCHUL_CODE}&MLSV_YMD=${apiDate}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.mealServiceDietInfo) {
                    const meals = data.mealServiceDietInfo[1].row;
                    renderMeals(meals);
                    generateRuleBasedSummary(meals); // 1ë‹¨ê³„: ë£° ê¸°ë°˜ ìš”ì•½ ì‹¤í–‰
                }
            } catch (e) { console.error(e); }
        }

        function renderMeals(meals) {
            meals.forEach(meal => {
                const cleanMenu = meal.DDISH_NM.replace(/\([0-9.]+\)/g, '').replace(/<br\/>/gi, '\n');
                if (meal.MMEAL_SC_NM === 'ì¤‘ì‹') {
                    document.getElementById('lunch-content').innerText = cleanMenu;
                    document.getElementById('lunch-nutrition').innerText = `ì¹¼ë¡œë¦¬: ${meal.CAL_INFO}`;
                } else if (meal.MMEAL_SC_NM === 'ì„ì‹') {
                    document.getElementById('dinner-content').innerText = cleanMenu;
                    document.getElementById('dinner-nutrition').innerText = `ì¹¼ë¡œë¦¬: ${meal.CAL_INFO}`;
                }
            });
        }

        // ==========================================
        // [í•µì‹¬ ê¸°ëŠ¥] 1ë‹¨ê³„: ë£°(Rule) ê¸°ë°˜ ìš”ì•½ ì•Œê³ ë¦¬ì¦˜
        // ==========================================
        function generateRuleBasedSummary(meals) {
            // ëª¨ë“  ë©”ë‰´ í…ìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ë¡œ í•©ì¹©ë‹ˆë‹¤.
            const allMenus = meals.map(m => m.DDISH_NM).join(' ');

            // í‚¤ì›Œë“œ ì‚¬ì „ (Rule Set)
            const rules = [
                { keywords: ['ì‹œí—˜', 'ìˆ˜ëŠ¥', 'ì°¹ìŒ€ë–¡'], msg: 'ğŸ’¯ ì‹œí—˜ ëŒ€ë°• ê¸°ì›! ë“ ë“ í•œ ì‘ì› ì‹ë‹¨ì…ë‹ˆë‹¤.' },
                { keywords: ['ì¼€ì´í¬', 'ì¶•í•˜', 'ì´ë²¤íŠ¸'], msg: 'ğŸ‰ ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ì´ë²¤íŠ¸ ë©”ë‰´ê°€ ìˆë„¤ìš”!' },
                { keywords: ['ëˆê¹ŒìŠ¤', 'ì¹˜í‚¨', 'íƒ•ìˆ˜ìœ¡', 'ê³ ê¸°', 'ìŠ¤í…Œì´í¬', 'ë¶ˆê³ ê¸°', 'ì¥ì¡°ë¦¼'], msg: 'ğŸ’ª ì˜¤ëŠ˜ì€ ë‹¨ë°±ì§ˆ ê°€ë“! ê³ ê¸° ë°˜ì°¬ì´ ë©”ì¸ì…ë‹ˆë‹¤.' },
                { keywords: ['ë¹„ë¹”ë°¥', 'ìƒëŸ¬ë“œ', 'ë‚˜ë¬¼', 'ë¬´ì¹¨'], msg: 'ğŸŒ¿ ì‹ ì„ í•œ ì±„ì†Œì™€ í•¨ê»˜í•˜ëŠ” ê±´ê°•í•œ í•˜ë£¨!' },
                { keywords: ['ë§ˆë¼', 'ì§¬ë½•', 'ë–¡ë³¶ì´', 'ê¹€ì¹˜'], msg: 'ğŸ”¥ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í’€ë¦¬ëŠ” ë§¤ì½¤í•œ ë§›ì˜ í–¥ì—°!' },
                { keywords: ['êµ­ìˆ˜', 'ìŠ¤íŒŒê²Œí‹°', 'íŒŒìŠ¤íƒ€', 'ìš°ë™'], msg: 'ğŸœ í›„ë£¨ë£©! ë§›ìˆëŠ” ë©´ ìš”ë¦¬ê°€ ë‚˜ì™”ì–´ìš”.' }
            ];

            let summary = '';

            // ê·œì¹™ ë§¤ì¹­ (ìˆœì„œëŒ€ë¡œ ê²€ì‚¬í•˜ì—¬ ê°€ì¥ ë¨¼ì € ê±¸ë¦¬ëŠ” ê·œì¹™ì„ ì±„íƒ)
            for (const rule of rules) {
                // some(): ë°°ì—´ ì¤‘ í•˜ë‚˜ë¼ë„ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ true
                if (rule.keywords.some(keyword => allMenus.includes(keyword))) {
                    summary = rule.msg;
                    break; // í•˜ë‚˜ ì°¾ìœ¼ë©´ ì¤‘ë‹¨ (ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ê²ƒë§Œ í‘œì‹œ)
                }
            }

            // ë§¤ì¹­ëœ ë£°ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€
            if (!summary) summary = 'ğŸ± ì˜¤ëŠ˜ë„ ë§›ìˆëŠ” ê¸‰ì‹ì´ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';

            // í™”ë©´ í‘œì‹œ
            const banner = document.getElementById('summary-banner');
            banner.innerText = summary;
            banner.style.display = 'block';
        }
    </script>
</body>
</html>